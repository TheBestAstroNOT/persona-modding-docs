<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>
</head>
<body>
  <!-- Include the script that builds the page and powers Decap CMS -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  <script>
    CMS.registerPreviewStyle("./example.css");
    const { createElement: h } = React;
      const ReactMarkdown = window['react-markdown'];
      const remarkGfm = window.remarkGfm.default;
      const remarkDirective = window.remarkDirective.default;
      const remarkAdmonitions = window.remarkAdmonitions;

      const Admonition = ({ className = '', children }) => {
        const type =
          className?.split(' ').find(cls => cls.startsWith('admonition-'))?.replace('admonition-', '') || 'note';

        return h(
          'div',
          { className: `admonition admonition-${type}` },
          [
            h('div', { className: 'admonition-title' }, type.charAt(0).toUpperCase() + type.slice(1)),
            h('div', { className: 'admonition-content' }, children)
          ]
        );
      };

      const Preview = createClass({
        render: function () {
          const entry = this.props.entry;
          const content = entry.getIn(['data', 'body']) || '';
          return h(ReactMarkdown, {
            children: content,
            remarkPlugins: [remarkGfm, remarkDirective, remarkAdmonitions],
            components: {
              div({ node, className, ...props }) {
                if (className?.includes('admonition')) {
                  return h(Admonition, { className, ...props });
                }
                return h('div', { className, ...props });
              }
            }
          });
        }
      });

      CMS.registerPreviewTemplate('*', Preview);
  </script>
</body>
</html>