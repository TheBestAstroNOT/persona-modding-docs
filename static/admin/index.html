<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Content Manager</title>
    <link rel="stylesheet" href="./preview.css" />
  </head>
  <body>
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
    <script>
      function parseAdmonitions(markdown) {
        return markdown
          .replace(/:::info\s([\s\S]+?):::/g, (_, content) =>
            `<div class="admonition admonition-info">
              <div class="admonition-title">Info</div>
              <div class="admonition-content">${content.trim().replace(/\n/g, '<br>')}</div>
            </div>`
          )
          .replace(/:::warning\s([\s\S]+?):::/g, (_, content) =>
            `<div class="admonition admonition-warning">
              <div class="admonition-title">Warning</div>
              <div class="admonition-content">${content.trim().replace(/\n/g, '<br>')}</div>
            </div>`
          )
          .replace(/:::danger\s([\s\S]+?):::/g, (_, content) =>
            `<div class="admonition admonition-danger">
              <div class="admonition-title">Danger</div>
              <div class="admonition-content">${content.trim().replace(/\n/g, '<br>')}</div>
            </div>`
          );
      }

      const Preview = createClass({
        render: function () {
          const body = this.props.entry.getIn(['data', 'body']) || '';
          const parsed = parseAdmonitions(body);
          return h('div', { dangerouslySetInnerHTML: { __html: parsed } });
        }
      });

      // Register the preview for all templates
      [
        "blog", "audio", "events", "flowscript", "getting-started", "models", "porting", "using-mods"
      ].forEach(name => CMS.registerPreviewTemplate(name, Preview));

      CMS.registerPreviewStyle("./preview.css");
    </script>
  </body>
</html>
